import { useSignal, useVisibleTask$, noSerialize, $ } from '@builder.io/qwik';
import { isBrowser } from '@builder.io/qwik/build';
import autoAnimate from '../index.mjs';

/**
 * AutoAnimate hook for adding dead-simple transitions and animations to qwik.
 * @param options - Auto animate options or a plugin
 * @returns
 */
function useAutoAnimate(options) {
    const parentRef = useSignal();
    const controller = useSignal();
    useVisibleTask$(({ track }) => {
        const element = track(() => parentRef.value);
        if (element && isBrowser) {
            controller.value = noSerialize(autoAnimate(element, options));
        }
    });
    const setEnabled = $((enabled) => {
        const ctl = controller.value;
        if (ctl) {
            typeof enabled === "function"
                ? enabled(ctl.isEnabled())
                    ? ctl.enable()
                    : ctl.disable()
                : enabled
                    ? ctl.enable()
                    : ctl.disable();
        }
    });
    return [parentRef, setEnabled];
}

export { useAutoAnimate };
