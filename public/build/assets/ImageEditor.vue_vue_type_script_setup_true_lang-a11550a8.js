import{d as M,q as B,am as E,f as o,o as c,a as m,D as d,bl as oe,b as i,t as f,c as A,Q as re,aj as le,ak as ne,F as ie,g as x,v as q,n as R,R as W,P as H,j,bm as J,bn as ue,w as _,G as k,e as ce,bo as de,a5 as pe,a4 as X,bp as me,ae as P,b2 as fe,bq as U,br as ve,bs as be,bt as he,bu as ge,bv as _e,bw as ye}from"./vendor-d45124f2.js";import{v as Fe,x as te,a as C,h as $e,y as Y,_ as K,t as Z}from"./index-1b5bb668.js";const ke=["src","alt"],Ce={key:1,class:"relative flex aspect-square h-full items-center justify-center"},we={class:"absolute translate-y-1 font-mono text-sm font-semibold uppercase text-gray-500"},ee=M({__name:"FileThumbnail",props:{file:{}},setup(D){const y=D,u=B(y.file.preview_url||y.file.original_url),h=new FileReader;return h.onloadend=g=>{u.value=h.result},E(()=>y.file.file,()=>{y.file.file&&h.readAsDataURL(y.file.file)},{immediate:!0}),(g,p)=>{var w;return o(Fe)(g.file.file_name)?(c(),m("img",{key:0,src:u.value,alt:((w=g.file.custom_properties)==null?void 0:w.name)||g.file.file_name,class:"aspect-square w-full rounded object-cover"},null,8,ke)):(c(),m("div",Ce,[d(o(oe),{class:"w-full max-w-[5rem] stroke-1 text-gray-500"}),i("span",we,f(o(te)(g.file.file_name)),1)]))}}}),xe={class:"w-full"},De=["for"],ze={class:"mt-1 rounded-md shadow-sm sm:col-span-2 sm:mt-0"},Ie=["for"],Ne=["id","name","accept","onInput"],Oe=["onClick"],Ve={key:1,class:"divide-y divide-gray-100 border-gray-300"},je={class:"group relative"},Be={class:"absolute inset-0 flex flex-col items-center justify-center gap-3 rounded bg-gray-900/60 p-2 opacity-0 transition-opacity group-hover:opacity-100"},Se=["for"],Te=["id","name","accept","onInput"],Ae={class:"text-sm text-gray-500"},Re={class:"uppercase"},Ue={class:"col-span-2 space-y-3"},Ee=["onClick"],Le=["for"],qe=["id","name","multiple","accept"],Xe={class:"space-y-1"},Ye={class:"flex text-sm text-gray-600"},Pe={key:0},Me={key:1},Ge={class:"text-xs text-gray-500"},Qe={key:0},We={key:1},tt=M({__name:"Dropzone",props:{name:{},label:{},modelValue:{default:[]},accept:{},maxNumberOfFiles:{type:[Number,Boolean]},onlyThumbs:{type:Boolean},maxFileSize:{},centered:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(D,{emit:y}){const u=D,h=A(()=>{var a,l;return u.maxFileSize?u.maxFileSize:((l=(a=re().props.config)==null?void 0:a.media_library)==null?void 0:l.max_file_size)??2*1024*1024}),g=A(()=>!u.maxNumberOfFiles||u.maxNumberOfFiles>1),p=le(),w=y,b=B(u.modelValue),F=A(()=>{var e;return b.value?(e=b.value)==null?void 0:e.filter(a=>!a.action||a.action!=="delete").sort((a,l)=>a.order_column-l.order_column):[]});E(()=>[b.value],()=>{var e;w("update:modelValue",(e=b.value)==null?void 0:e.map(a=>ne(a,["file"])))},{deep:!0}),E(()=>u.modelValue,e=>{e==null||e.forEach(a=>{var t;const l=(t=b.value)==null?void 0:t.find(n=>n.path===a.file_name);b.value&&l&&(b.value.find(n=>n.path===a.file_name).action=null)})},{deep:!0});const S=e=>{const a=Array.from(e.target.files);N(a)},z=e=>{e&&(e.action="delete")},I=A(()=>{var e;return u.accept?(e=u.accept)==null?void 0:e.split(",").map(a=>a.includes("/")&&a.split("/")[1]!=="*"?`.${a.split("/")[1]}`:a).join(", "):""}),s=B(!1),r=()=>{s.value=!0},v=()=>{s.value=!1},T=e=>{const a=Array.from(e.dataTransfer.files);N(a),s.value=!1},N=e=>{u.maxNumberOfFiles&&(e=e.slice(0,u.maxNumberOfFiles-F.value.length)),e.forEach(a=>{if(a.size>h.value){p.error(Z("craftable-pro","File size is too big!"));return}const l=new FormData;l.append("file",a),P.post("/admin/upload",l,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{b.value.push({id:null,uuid:fe(),collection_name:"images",action:"add",path:t.data.path,size:a.size,file_name:a.name,custom_properties:{name:a.name,alt:""},file:a})}).catch(t=>{p.error(t.message)})})},$=(e,a)=>{const l=Array.from(a.target.files)[0];if(l){if(l.size>h.value){p.error(Z("craftable-pro","File size is too big!"));return}const t=new FormData;t.append("file",l),P.post("/admin/upload",t,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>{var G,Q;const O=(G=b.value)==null?void 0:G.findIndex(L=>L.uuid===e),V=(Q=b.value)==null?void 0:Q.find(L=>L.uuid===e);typeof O<"u"&&O!==-1&&V&&(z(V),b.value.splice(O,0,{...V,id:null,action:"add",path:n.data.path,file:l,file_name:l.name,size:l.size}))}).catch(n=>{p.error(n.message)})}},ae=(e,a,l)=>{U.set(e.custom_properties,a,l)},se=(e,a)=>(U.get(e==null?void 0:e.custom_properties,a)||U.set(e.custom_properties,a,""),U.get(e==null?void 0:e.custom_properties,a));return(e,a)=>{const l=ie("auto-animate");return c(),m("div",xe,[e.label?(c(),m("label",{key:0,for:e.name,class:"mb-1 block text-sm font-medium text-gray-700"},f(e.label),9,De)):x("",!0),q((c(),m("div",ze,[F.value.length?(c(),m("div",{key:0,class:R(["rounded-md border border-gray-300",{"rounded-b-none border-b-0":!e.maxNumberOfFiles||F.value.length<e.maxNumberOfFiles}])},[e.onlyThumbs?q((c(),m("div",{key:0,class:R(["flex flex-wrap items-center gap-4 p-5",{"justify-center":e.centered}])},[(c(!0),m(W,null,H(F.value,t=>(c(),m("div",{key:t.uuid,class:"group relative"},[j(e.$slots,"thumb",{file:t},()=>[d(ee,{file:t},null,8,["file"])]),i("label",{for:t.uuid,type:"button",class:"absolute inset-0 flex cursor-pointer items-center justify-center rounded bg-gray-900/60 opacity-0 transition-opacity group-hover:opacity-100"},[d(o(J),{class:"h-8 w-8 text-white"}),i("input",{id:t.uuid,class:"sr-only absolute",type:"file",name:t.uuid,multiple:"false",accept:e.accept,onInput:n=>$(t.uuid,n)},null,40,Ne)],8,Ie),i("button",{type:"button",class:"text-danger-500 hover:text-danger-700 absolute -right-2 -top-2 rounded-full bg-white",onClick:n=>z(t)},[d(o(ue),{class:"h-6 w-6"})],8,Oe)]))),128))],2)),[[l]]):q((c(),m("div",Ve,[(c(!0),m(W,null,H(F.value,t=>(c(),m("div",{key:t.uuid,class:"relative grid grid-cols-[8rem_repeat(3,_1fr)] items-center gap-5 p-5"},[i("div",je,[j(e.$slots,"thumb",{file:t},()=>[d(ee,{file:t},null,8,["file"])]),i("div",Be,[i("label",{for:t.uuid,type:"button"},[d(o(C),{"left-icon":o(J),size:"sm",color:"gray",variant:"outline",as:"span"},{default:_(()=>[k(f(e.$t("craftable-pro","Replace")),1)]),_:1},8,["left-icon"]),i("input",{id:t.uuid,class:"sr-only absolute",type:"file",name:t.uuid,multiple:"false",accept:e.accept,onInput:n=>$(t.uuid,n)},null,40,Te)],8,Se),t.id?x("",!0):(c(),ce(o($e),{key:0,size:"lg"},{trigger:_(({setIsOpen:n})=>[d(o(C),{size:"sm",color:"gray",variant:"outline","left-icon":o(de),onClick:()=>n(!0)},{default:_(()=>[k(f(e.$t("craftable-pro","Crop")),1)]),_:2},1032,["left-icon","onClick"])]),content:_(({setIsOpen:n})=>[d(o(Ke),{src:t,onOnCrop:(O,V)=>{t.file=O,t.path=V,n(!1)}},null,8,["src","onOnCrop"])]),_:2},1024))])]),i("div",Ae,[i("p",Re,f(o(te)(t.file_name)),1),i("p",null,f(o(Y)(t.size)),1)]),i("div",Ue,[j(e.$slots,"inputs",{file:t,setCustomProperty:ae,getCustomProperty:se},()=>[d(o(K),{modelValue:t.custom_properties.name,"onUpdate:modelValue":n=>t.custom_properties.name=n,size:"sm",label:"File name",name:`${t.uuid??t.id}_name`},null,8,["modelValue","onUpdate:modelValue","name"]),d(o(K),{modelValue:t.custom_properties.alt,"onUpdate:modelValue":n=>t.custom_properties.alt=n,size:"sm",label:"Alt text",name:`${t.uuid??t.id}_alt`},null,8,["modelValue","onUpdate:modelValue","name"])])]),i("button",{type:"button",class:"absolute right-3 top-2 rounded-full text-gray-500 hover:text-gray-700",onClick:n=>z(t)},[d(o(pe),{class:"h-6 w-6"})],8,Ee)]))),128))])),[[l]])],2)):x("",!0),!e.maxNumberOfFiles||F.value.length<e.maxNumberOfFiles?(c(),m("label",{key:1,for:e.name,class:R(["relative block shrink-0 cursor-pointer rounded-b-md border border-dashed p-5",{"rounded-t-md":!F.value.length,"border-primary-400":s.value,"hover:border-primary-400 border-gray-300":!s.value}]),onDragover:X(r,["prevent"]),onDragleave:X(v,["prevent"]),onDrop:X(T,["prevent"])},[i("input",{id:e.name,class:"sr-only absolute",type:"file",name:e.name,multiple:g.value,accept:e.accept,onInput:S},null,40,qe),i("div",{class:R(["flex items-center gap-2",{"flex-col text-center":e.centered}])},[j(e.$slots,"placeholder",{maxNumberOfFiles:e.maxNumberOfFiles,formatedAccept:I.value,maxFileSize:h.value,formatBytes:o(Y)},()=>[j(e.$slots,"icon",{},()=>[d(o(me),{class:"h-10 w-10 stroke-1 text-gray-500"})]),i("div",Xe,[i("div",Ye,[a[0]||(a[0]=i("span",null,"Select or drag and drop",-1)),e.maxNumberOfFiles&&e.maxNumberOfFiles>1?(c(),m("span",Pe," > maximum of "+f(e.maxNumberOfFiles)+" files",1)):(c(),m("span",Me," file"))]),i("p",Ge,[I.value?(c(),m("span",Qe,f(I.value),1)):x("",!0),h.value?(c(),m("span",We," up to "+f(o(Y)(h.value)),1)):x("",!0)])])])],2)],42,Le)):x("",!0)])),[[l]])])}}}),He={class:"mb-4 flex items-center justify-between gap-2"},Je={class:"flex items-center gap-2"},Ke=M({__name:"ImageEditor",props:{src:{}},emits:["onCrop"],setup(D,{emit:y}){const u=D,h=y,g=B(u.src.preview_url||u.src.original_url),p=B(null),w=new FileReader;w.onloadend=s=>{var r,v;g.value=(r=s.target)==null?void 0:r.result,p.value&&p.value.replace((v=s.target)==null?void 0:v.result)},E(()=>u.src.file,()=>{u.src.file&&w.readAsDataURL(u.src.file)},{immediate:!0});const b=()=>{var r;let s=(r=p.value)==null?void 0:r.getData().scaleX;s=s?-s:-1,p.value.scaleX(s)},F=()=>{var r,v;let s=(r=p.value)==null?void 0:r.getData().scaleY;s=s?-s:-1,(v=p.value)==null||v.scaleY(s)},S=s=>{var r;(r=p.value)==null||r.rotate(s)},z=()=>{var s,r,v;(v=p.value)==null||v.setCropBoxData({left:0,top:0,width:(s=p.value)==null?void 0:s.getImageData().width,height:(r=p.value)==null?void 0:r.getImageData().height})},I=()=>{var r;const s=(r=p.value)==null?void 0:r.getCroppedCanvas();s.toDataURL(),s.toBlob(v=>{const T=new File([v],"cropped.jpg",{type:"image/jpeg"}),N=new FormData;N.append("file",T),P.post("/admin/upload",N,{headers:{"Content-Type":"multipart/form-data"}}).then($=>{h("onCrop",T,$.data.path)}).catch($=>{console.error($==null?void 0:$.message)})})};return(s,r)=>(c(),m("div",null,[i("div",He,[i("div",Je,[d(o(C),{variant:"outline",leftIcon:o(ve),onClick:r[0]||(r[0]=v=>S(-90))},{default:_(()=>[k(f(s.$t("craftable-pro","Rotate left")),1)]),_:1},8,["leftIcon"]),d(o(C),{variant:"outline",leftIcon:o(be),onClick:r[1]||(r[1]=v=>S(90))},{default:_(()=>[k(f(s.$t("craftable-pro","Rotate right")),1)]),_:1},8,["leftIcon"]),d(o(C),{variant:"outline",leftIcon:o(he),onClick:b},{default:_(()=>[k(f(s.$t("craftable-pro","Flip X")),1)]),_:1},8,["leftIcon"]),d(o(C),{variant:"outline",leftIcon:o(ge),onClick:F},{default:_(()=>[k(f(s.$t("craftable-pro","Flip Y")),1)]),_:1},8,["leftIcon"]),d(o(C),{variant:"outline",leftIcon:o(_e),onClick:z},{default:_(()=>[k(f(s.$t("craftable-pro","Select whole image")),1)]),_:1},8,["leftIcon"])]),d(o(C),{onClick:I},{default:_(()=>[k(f(s.$t("craftable-pro","Crop image")),1)]),_:1})]),d(o(ye),{ref_key:"cropper",ref:p,src:g.value,movable:!1,zoomable:!1,viewMode:1},null,8,["src"])]))}});export{tt as _,ee as a};
