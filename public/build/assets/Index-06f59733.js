import{d as R,c as D,q as O,N as U,o as n,a as m,b as r,D as f,w as u,n as N,a4 as j,e as p,f as o,c0 as z,b$ as E,c1 as M,g as L,R as c,G as x,t as V,P as $,F as S,v as q,aL as A,aJ as G,aK as J}from"./vendor-fc9552fb.js";import{L as I,d as T,a as K,f as H,i as F}from"./index-3d1a2934.js";import{_ as Q}from"./PageHeader.vue_vue_type_script_setup_true_lang-8b2a5c80.js";import{_ as W}from"./PageContent.vue_vue_type_script_setup_true_lang-f12642fa.js";import{u as X}from"./useForm-6d5d09d9.js";const Y={key:0,class:"contents"},Z=R({__name:"PermissionTableRow",props:{modelValue:{},permission:{},permissionName:{},level:{default:0}},emits:["update:modelValue"],setup(y,{emit:w}){const s=y,b=w,d=D({get:()=>s.modelValue,set:e=>{b("update:modelValue",e)}}),v=O(!0),g=D(()=>typeof s.permission=="object"),h=e=>e.permissions.includes(s.permission),k=e=>{const t=s.modelValue.findIndex(i=>i.id===e.id);if(h(e)){const i=s.modelValue[t].permissions.filter(function(l){return l!==s.permission});s.modelValue[t].permissions=i}else s.modelValue[t].permissions.push(s.permission);b("update:modelValue",s.modelValue)},_=e=>{const t=s.modelValue.findIndex(a=>a.id===e.id),i=C(s.permission),l=s.modelValue[t].permissions;return i.every(a=>l.includes(a))?!0:i.every(a=>!l.includes(a))?!1:null},B=(e,t)=>{const i=s.modelValue.findIndex(a=>a.id===e.id),l=C(s.permission);if(t)l.forEach(a=>{s.modelValue[i].permissions.push(a)});else{const a=s.modelValue[i].permissions.filter(function(P){return!l.includes(P)});s.modelValue[i].permissions=a}b("update:modelValue",s.modelValue)},C=e=>{let t=[];for(var i in e)e.hasOwnProperty(i)&&(typeof e[i]=="object"?t=t.concat(C(e[i])):t.push(e[i]));return t};return(e,t)=>{const i=U("PermissionTableRow",!0);return n(),m(c,null,[r("tr",{class:N(["border-b",{"bg-indigo-50":e.level===0,"bg-slate-50":e.level===1,"bg-white":e.level>1}])},[f(o(I),{class:"relative py-0 pr-0"},{default:u(()=>[r("div",{class:N(["flex",{"pl-8":e.level===1,"pl-16":e.level===2,"pl-24":e.level===3,"pl-32":e.level===4}])},[g.value?(n(),m("button",{key:0,type:"button",onClick:t[0]||(t[0]=j(l=>v.value=!v.value,["prevent"])),class:"flex"},[v.value?(n(),p(o(z),{key:0,class:"h-5 w-5"})):(n(),p(o(E),{key:1,class:"h-5 w-5"})),f(o(M),{class:"ml-3 mr-2 h-5 w-5"})])):L("",!0),r("div",{class:N(["text-sm text-slate-900",{"font-medium":e.level===0}])},[g.value?(n(),m(c,{key:0},[x(V(e.$t("permissions",e.permissionName)),1)],64)):(n(),m(c,{key:1},[x(V(e.$t("permissions",e.permission)),1)],64))],2)],2)]),_:1}),g.value?(n(!0),m(c,{key:0},$(d.value,l=>(n(),p(o(I),{class:"border-l"},{default:u(()=>[f(o(T),{class:"justify-center",modelValue:_(l)===null||_(l),checked:_(l)===null||_(l),indeterminate:_(l)===null,onChange:a=>a.target.checked?B(l,!0):B(l,!1)},null,8,["modelValue","checked","indeterminate","onChange"])]),_:2},1024))),256)):(n(!0),m(c,{key:1},$(d.value,l=>(n(),p(o(I),{class:"border-l"},{default:u(()=>[f(o(T),{class:"justify-center",modelValue:h(l),onChange:a=>k(l)},null,8,["modelValue","onChange"])]),_:2},1024))),256))],2),g.value&&v.value?(n(),m("div",Y,[(n(!0),m(c,null,$(Object.entries(e.permission),([l,a])=>(n(),p(i,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=P=>d.value=P),permission:a,permissionName:e.permissionName+"."+l,level:e.level+1,key:l},null,8,["modelValue","permission","permissionName","level"]))),128))])):L("",!0)],64)}}}),ee={class:"overflow-x-auto sm:rounded-t-md sm:rounded-b-md"},se={class:"inline-block min-w-full align-middle"},le={class:"relative overflow-hidden"},ne={class:"min-w-full divide-y divide-gray-200"},oe={class:"bg-gray-50"},te={class:"text-xs font-medium text-slate-500"},ie={class:"text-sm font-normal text-slate-900"},ae={class:"w-60"},re={class:"text-xs font-medium text-slate-500"},de={class:"text-sm font-normal text-slate-900"},me=R({__name:"Index",props:{roles:{},permissions:{}},setup(y){const w=y,{form:s,submit:b}=X({roles:w.roles},route("craftable-pro.permissions.update"));return(d,v)=>{const g=S("can");return n(),m(c,null,[f(o(Q),{sticky:"",title:d.$t("craftable-pro","Manage permissions")},{default:u(()=>[q((n(),p(o(K),{leftIcon:o(A),onClick:o(b)},{default:u(()=>[x(V(d.$t("craftable-pro","Save")),1)]),_:1},8,["leftIcon","onClick"])),[[g,"craftable-pro.permission.edit"]])]),_:1},8,["title"]),f(o(W),null,{default:u(()=>[f(o(H),{noPadding:""},{default:u(()=>[r("div",ee,[r("div",se,[r("div",le,[r("table",ne,[r("thead",oe,[r("tr",null,[f(o(F),{class:"bg-white"},{default:u(()=>[r("div",te,V(d.$t("craftable-pro","User")),1),r("div",ie,V(d.$t("craftable-pro","Permission")),1)]),_:1}),(n(!0),m(c,null,$(d.roles,h=>(n(),p(o(F),{key:h.name,class:"w-60 border-l bg-white"},{default:u(()=>[r("div",ae,[r("div",re,V(d.$t("craftable-pro","Role")),1),r("div",de,V(h.name),1)])]),_:2},1024))),128))])]),r("tbody",null,[(n(!0),m(c,null,$(d.permissions,(h,k)=>(n(),p(Z,{modelValue:o(s).roles,"onUpdate:modelValue":v[0]||(v[0]=_=>o(s).roles=_),permission:h,permissionName:k},null,8,["modelValue","permission","permissionName"]))),256))])])])])])]),_:1})]),_:1})],64)}}}),he=R({__name:"Index",props:{roles:{},permissions:{}},setup(y){const w=y;return(s,b)=>(n(),p(me,G(J(w)),null,16))}});export{he as default};
